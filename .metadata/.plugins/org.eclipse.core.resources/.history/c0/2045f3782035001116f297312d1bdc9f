<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.flexutil.expl.ReportMapper">
	
	<resultMap type="WellNameVO" id="wellNameVO">
		<id column="W_ID" property="wellId"  />
		<result column="EXPL_WB_NAME" property="wellName"  />
	</resultMap>
	
	<resultMap type="GFCDWeeklyHeaderVO" id="gFCDWeeklyHeaderVO">
		<id column="W_PHID" property="primaryHoleId"  />
		<result column="W_CLASS" property="wellClass"  />
		<result column="W_COUNT" property="wellCount"  />
	</resultMap>
	
	<resultMap type="GFCDWeeklyDetailVO" id="gFCDWeeklyDetailVO">
		<id column="AJ_WB_NAME" property="AJWellName"  />
		<result column="WELL_CLASS" property="wellClass"  />
		<result column="W_ID" property="wellId"  />
		<result column="WB_DPN_NUM" property="deepeningNo"  />
		<result column="EP_A_NUM" property="epANum"  />
		<result column="EXPL_WB_NAME" property="wellName"  />
		<result column="RIG_NAME" property="rigName"  />
		<result column="TARGET_FORM" property="targetFormation"  />
		<result column="WELL_TYPE" property="wellType"  />
		<result column="TOTAL_DAYS" property="totalDays"  />
		<result column="WEEKLY_FOOTAGE" property="weeklyFootage"  />
		<result column="DAILY_DATA" property="dailyData"  />
		<result column="OP_SUMMARY" property="OPSummary"  />
	</resultMap>
	
  
	
	<resultMap type="VpReportVO" id="vpReportVO">
		<id column="EP_A_NUM" property="epANum"  />
		<result column="W_BORE" property="wBoreNum"  />
		<result column="REPORT_DT" property="reportDate"  />
		<result column="GROUP_NAME" property="groupName"  />
		<result column="W_RIG_CD" property="rigName"  />
		<result column="WELLBORE" property="wellboreName"  />
		<result column="OBJECTIVE" property="wellObjective"  />
		<result column="W_PRSNT_DPTH" property="currentDepth"  />
		<result column="OPERATION" property="currentOperation"  />
		<result column="CUR_FORM" property="currentFormation"  />
		<result column="GAS_PLANT" property="gasPlant"  />
		<result column="F_CD" property="fieldCode"  />
		<result column="STATUS" property="status"  />
		<result column="EP_CR_DATA_CD" property="createdBy"  />
		<result column="EP_CR_DATA_DT" property="createDate"  />
		<result column="EP_LT_DMO_CD" property="updatedBy"  />
		<result column="EP_LT_DATA_MOD_DT" property="updateDate"  />
	</resultMap>
	<resultMap type="GISWellBore" id="gisWellBore">
		<id column="EP_A_NUM" property="epANum"  />
		<result column="W_PRIM_HID" property="primaryHoleId"  />
		<result column="EXPL_WB_NAME" property="wellLabel"  />
		<result column="SV_DD_LON_CORD" property="longitude"  />
		<result column="SV_DD_LAT_CORD" property="latitue"  />
	</resultMap>
	
	<select id="GIS.WELLBORE.ReportMapper" parameterType="string"  resultMap="gisWellBore" timeout="10">
		SELECT rw.ep_a_num,DECODE(rw.w_prim_hid,'ANDR','GHWR','SDGM','GHWR','UTMN','GHWR','HWYH','GHWR','HRDH','GHWR',rw.w_prim_hid) w_prim_hid,
		       expl_wb_name,sv_dd_lat_cord,sv_dd_lon_cord
		  FROM exad_rcd_wellbores_vw rw,well_master wlm 
		 WHERE wlm.ep_a_num    = rw.ep_a_num  
		   AND rw.div 		   = 'GFCD' 
		   AND rw.expl_wb_name = #{wName}
	</select>
	

   
   
	
	
	<select id="HEADER.GFCDWeeklyPresentation.ReportMapper" parameterType="map"  statementType="CALLABLE" timeout="10">
    	{ CALL EXAD_WBA_RCD_PKG.GFCD_WEEKLY_PRESENTATION_HDR(
    		#{wellheader, mode=OUT, resultMap=gFCDWeeklyHeaderVO,jdbcType=CURSOR,javaType=java.sql.ResultSet},
    		#{wellIds, mode=IN, jdbcType=VARCHAR}
    		)}
	</select>
	<select id="DETAIL.GFCDWeeklyPresentation.ReportMapper" parameterType="map"  statementType="CALLABLE" timeout="10">
    	{ CALL EXAD_WBA_RCD_PKG.GFCD_WEEKLY_PRESENTATION_DTL(
    		#{welldetail, mode=OUT, resultMap=gFCDWeeklyDetailVO,jdbcType=CURSOR,javaType=java.sql.ResultSet},
    		#{wellIds, mode=IN, jdbcType=VARCHAR}
    		)}
	</select>
	
	<select id="SELECT.GFCDWeeklyPresentation.ReportMapper" resultMap="wellNameVO" >
		SELECT w_id,expl_wb_name
  		  FROM exad_rcd_wellbores_vw
 		 WHERE div = 'GFCD'
   	     --AND (w_id) IN (SELECT w_id FROM exad_rcd_dailies rd WHERE daily_dt BETWEEN TRUNC(SYSDATE) - 7 AND TRUNC(SYSDATE)) 
   		   AND (w_id,WB_DPN_NUM) IN (SELECT w_id,WB_DPN_NUM FROM exad_rcd_dailies rd 
                              WHERE daily_dt BETWEEN (TRUNC(sysdate) - 107) AND (TRUNC(sysdate) - 100)
               )
   		ORDER BY w_prim_hid,w_num,w_bore
	</select>

	<insert id="SYNC_VP_HEADER.ReportMapper" parameterType="string" timeout="10">
		INSERT INTO  EXAD_RCD_VP_RPT_HEADER(EP_A_NUM,OBJECTIVE,W_BORE,GROUP_NAME)
	    SELECT RA.ep_a_num,   
	          (SELECT SHORT_OBJECTIVE FROM EXAD_RCD_WELLBORES_VW 
	            WHERE EP_A_NUM = RA.ep_a_num 
	              AND W_BORE = SUBSTR(EXAD_WBA_UTIL_PKG.CURR_WB_AT_SHIFT_END(RA.ep_a_num,DOS.W_ACT_DT,'WB_EXPL_NAME'),-1) ), 
	          SUBSTR(EXAD_UTIL_PKG.CURR_WB_AT_SHIFT_END(RA.ep_a_num,DOS.W_ACT_DT,'WB_EXPL_NAME'),-1) W_BORE,  
	          DECODE(W_RIG_ACT_GRP_CD,'EXP', 
	                                  NVL( (SELECT DECODE(WELL_TYPE,'Oil Delineation','DELINEATION','Gas Delineation','DELINEATION','EXPLORATION')  
	                                          FROM EXAD_AED_WELLBORES  A 
	                                         WHERE A.EP_A_NUM = RA.ep_a_num 
	                                           AND W_BORE = SUBSTR(EXAD_WBA_UTIL_PKG.CURR_WB_AT_SHIFT_END(RA.ep_a_num,DOS.W_ACT_DT,'WB_EXPL_NAME'),-1)),'EXPLORATION'),
	                                  'OFFEX','EXPLORATION',
	                                  'GAS',  'DEVELOPMENT',
	                                  'GWO',  'WORKOVER',
	                                  'OFFG', 'DEVELOPMENT',
	                                  'OTHER') GRP_NAME 
	     FROM DRLG_OP_STATUS DOS, 
	          RIG_ACTIVITY   RA 
	    WHERE DOS.W_ACT_DT = to_date(#{reportDate},'mm/dd/yyyy') 
	      AND RA.RAC_NUM = DOS.RAC_NUM 
	      AND RA.W_RIG_ACT_GRP_CD IN (select code from exad_rcd_vp_category where status = 'Y') 
	      AND ra.ep_a_num IS NOT NULL 
	      AND NOT EXISTS (SELECT 1
	                        FROM EXAD_RCD_VP_RPT_HEADER rpt  
	                       WHERE rpt.ep_a_num = ra.ep_a_num   
	                         AND rpt.w_bore = SUBSTR(EXAD_UTIL_PKG.CURR_WB_AT_SHIFT_END(RA.ep_a_num,DOS.W_ACT_DT,'WB_EXPL_NAME'),-1))  
		
	</insert>
	<insert id="SYNC_VP_DETAILS.ReportMapper" parameterType="string" timeout="10">
		INSERT INTO  EXAD_RCD_VP_RPT_DETAILS(EP_A_NUM,W_BORE,REPORT_DT,OPERATION,STATUS) 
		SELECT drlg.ep_a_num,drlg.w_bore,drlg.W_ACT_DT,drlg.w_op_rmk,
		       NVL( (SELECT status 
			           FROM (SELECT ep_a_num,w_bore,status, RANK() OVER (PARTITION BY ep_a_num,w_bore ORDER BY report_dt DESC) rank 
							   FROM EXAD_RCD_VP_RPT_DETAILS 
							) vrd
					   WHERE vrd.rank = 1 AND  vrd.ep_a_num = drlg.ep_a_num AND vrd.w_bore=drlg.w_bore   ),'Y') 
		  FROM ( SELECT RA.ep_a_num, SUBSTR(EXAD_UTIL_PKG.CURR_WB_AT_SHIFT_END(RA.ep_a_num,DOS.W_ACT_DT,'WB_EXPL_NAME'),-1) W_BORE,  
					    TRUNC(DOS.W_ACT_DT) W_ACT_DT ,dos.w_op_rmk 
		           FROM DRLG_OP_STATUS      DOS, 
				        RIG_ACTIVITY        RA 
				  WHERE DOS.W_ACT_DT = to_date(#{reportDate},'mm/dd/yyyy') 
					AND RA.RAC_NUM = DOS.RAC_NUM 
					AND RA.W_RIG_ACT_GRP_CD IN (select code from exad_rcd_vp_category where status = 'Y')
					AND ra.ep_a_num IS NOT NULL 
				) drlg 
		 WHERE (drlg.ep_a_num,drlg.w_bore) NOT IN (SELECT ep_a_num,w_bore FROM EXAD_RCD_VP_RPT_DETAILS rpt
		                                            WHERE REPORT_DT = TO_DATE(#{reportDate},'mm/dd/yyyy'))
	</insert>
	<select id="SELECT.VP_WORKSHEET.ReportMapper" parameterType="string" resultMap="vpReportVO" timeout="10">
		SELECT REPORT_DT,hdr.EP_A_NUM,hdr.W_BORE,NVL(STATUS,'Y') STATUS,GROUP_NAME,RA.W_RIG_CD, 
			   EXAD_UTIL_PKG.CURR_WB_AT_SHIFT_END(RA.ep_a_num,DOS.W_ACT_DT,'WB_EXPL_NAME') Wellbore, 
			   hdr.OBJECTIVE,DOS.W_PRSNT_DPTH,dtl.OPERATION, 
		       NVL((SELECT cur_form FROM exad_rcd_dailies WHERE w_id = rw.w_id AND daily_dt = dtl.report_dt), 
			   (select cur_form from EXAD_AED_DAILIES where ep_a_num = hdr.EP_A_NUM and daily_dt = dtl.report_dt)) CUR_FORM,  
			   DECODE(GROUP_NAME,'DEVELOPMENT',NVL(GAS_PLANT,DECODE(RA.W_PRIM_HID,	'SDGM','SDGM', 
			   'UTMN','UTMN', 
			   'HWYH','HWYH', 
			   'KARN','KRSN', 
			   'ARBI','WASIT', 
			   'HSBH','WASIT', 
			   'HRDH')), 	   
			   NULL) GAS_PLANT, 
			   NVL(rw.F_CD,ra.W_PRIM_HID ) F_CD, 
			   dtl.EP_LT_DMO_CD,dtl.EP_LT_DATA_MOD_DT,dtl.EP_CR_DATA_CD,dtl.EP_CR_DATA_DT 
		  FROM EXAD_RCD_VP_RPT_HEADER hdr,
		       EXAD_RCD_VP_RPT_DETAILS dtl,
			   RIG_ACTIVITY        RA,
			   DRLG_OP_STATUS      DOS,
			   EXAD_RCD_WELLBORES RW   
		 WHERE dtl.REPORT_DT = to_date(#{reportDate},'mm/dd/yyyy') 
		   AND hdr.EP_A_NUM  = dtl.EP_A_NUM 
		   AND hdr.W_BORE    = dtl.W_BORE 
		   AND DOS.W_ACT_DT  = dtl.REPORT_DT 
		   AND DOS.EP_A_NUM  = dtl.EP_A_NUM 
		   AND RA.RAC_NUM    = DOS.RAC_NUM  
		   AND RA.EP_A_NUM   = dtl.EP_A_NUM 
		   AND RW.EP_A_NUM(+)= hdr.EP_A_NUM 
		   AND RW.W_BORE(+)  = hdr.W_BORE 
		ORDER BY DECODE(GROUP_NAME,'EXPLORATION',1,'DELINEATION',2,'WORKOVER',3,4) ,GAS_PLANT,WellBore  
	</select>
	<update id="UPDATE.VP_HEADER.ReportMapper" parameterType="vpReportVO" timeout="10">
		UPDATE EXAD_RCD_VP_RPT_HEADER SET OBJECTIVE = #{wellObjective,jdbcType=VARCHAR}, GROUP_NAME = #{groupName} 
		 WHERE  EP_A_NUM = #{epANum} AND W_BORE = #{wBoreNum}
	</update>
	<update id="UPDATE.VP_DETAILS.ReportMapper" parameterType="vpReportVO" timeout="10">
		UPDATE EXAD_RCD_VP_RPT_DETAILS
		   SET OPERATION = #{currentOperation,jdbcType=VARCHAR}, STATUS = #{status}
		 WHERE EP_A_NUM  = #{epANum}
		   AND W_BORE    = #{wBoreNum}
		   AND REPORT_DT = #{reportDate}
	</update>
</mapper>